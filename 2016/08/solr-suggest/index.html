<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"> <!-- pwa meta begin --><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#000"><meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="msapplication-tap-highlight" content="no"> <!-- IOS不会读取manifest中的icon，用此配置进行适配 --><link rel="apple-touch-icon" href="assets/icons/icon-96x96.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/icon-180x180.png"><link rel="apple-touch-icon" sizes="167x167" href="/assets/icons/icon-167x167.png"> <!-- ios修复splash黑屏 --><link href="/assets/icons/apple_splash_1125.png" sizes="1125x2436" rel="apple-touch-startup-image" /><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"> <!-- pwa meta end --><title>solr-suggest检索建议配置说明</title><meta name="description" content=""><meta name="keywords" content="solr,suggest"><link rel="icon" href="/assets/favicon.ico"><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/2016/08/solr-suggest/"><link rel="alternate" type="application/atom+xml" title="Jun Wong's Blog" href="/feed.xml" /></head><body> <!-- 全局页面loading --><div class="loading"><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div><!-- search --><div class="searchform"> <a href="javascript:void(0);" class="searchicon"></a> <input type="text" id="keyword"/> <a href="javascript:void(0);" class="clear"></a><ul class="suggest"></ul></div><script src="/assets/jquery-1.9.1.min.js"></script> <script src="/assets/main.js"></script> <script src="/assets/lab/geolocation.js"></script><nav class="header-nav"> <a class="page-link" href="/">HOME</a> / <a class="page-link" href="/categories/">CATEGORY</a> / <!-- <a class="page-link" href="/feed.xml">FEED</a> --> <a class="page-link" href="/lab/index.html">MYLAB</a> / <a class="page-link" href="/about/">ABOUT</a></nav><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article> <!-- 目录导航，在nav,js中进行渲染 --><div class="w-catalog"></div><div class="w-catalog-btn">目录</div><div class="center"><h1>solr-suggest检索建议配置说明</h1><time>2016-08-14</time></div><div class="divider"></div><ul id="markdown-toc"><li><a href="#2-利弊" id="markdown-toc-2-利弊">2. 利弊</a></li><li><a href="#3-前提" id="markdown-toc-3-前提">3. 前提</a></li><li><a href="#4-方式" id="markdown-toc-4-方式">4. 方式</a></li><li><a href="#5-配置" id="markdown-toc-5-配置">5. 配置</a><ul><li><a href="#51-修改solrconfigxml配置文件增加对suggest的配置" id="markdown-toc-51-修改solrconfigxml配置文件增加对suggest的配置">5.1 修改solrconfig.xml配置文件增加对suggest的配置</a></li><li><a href="#52-对应的schemaxml文件定义" id="markdown-toc-52-对应的schemaxml文件定义">5.2 对应的schema.xml文件定义</a></li></ul></li><li><a href="#6-测试" id="markdown-toc-6-测试">6. 测试</a></li></ul><p><strong>solr</strong> 的搜索建议是 <strong>solr</strong> 基本的功能之一，它提供类似于单词联想的功能，以友好的方式提供用户的搜索感觉。</p><h2 id="2-利弊">2. 利弊</h2><p><strong>solr</strong> 的 <strong>suggest</strong> 功能有利有弊，且大多数情况下弊大于利，特别是在数据量非常大的情况下，使用 <strong>suggest</strong> 时由于需要重建字典启动时间可能会很长。另外搜索建议依赖于拼写检查组件的功能，拼写检查可以单独做为一个功能使用，而 <strong>suggest</strong> 则不可以，必须结合拼写组件一起使用。</p><h2 id="3-前提">3. 前提</h2><p>配置 <strong>suggest</strong> 之前，需要确定输入源，比如商品的名称、分类的名称或者型号等等，这里使用的是商品助记码 <code class="highlighter-rouge">productCode</code> 类型是 <code class="highlighter-rouge">string</code>，建议的输入源不推荐使用复杂的类型。</p><h2 id="4-方式">4. 方式</h2><p><strong>suggest</strong> 的配置方式有两种，一种是 <strong>主库索引</strong>，另一种是 <strong>词库索引</strong>。</p><ol><li>主库索引存在的建议词，即数据库模型中某个字段。</li><li>使用自定义的词库作为建议词，所谓自定义词库就是需要使用文本维护好需要检索的关键词，放在对应 <strong>core</strong> 的 <strong>conf</strong> 目录即可。</li></ol><h2 id="5-配置">5. 配置</h2><p>下面使用自定义词库的方式去做 <strong>suggest</strong> 功能，首先需要准备好词库，如下的 <strong>suggest.txt</strong> 文件。</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># This is a sample dictionary file.
茅台飞天酒53度500ml
52度全兴·全民开窖500ml
法国进口红酒拉菲尚品波尔多干红葡萄酒
比利时督威/杜威duvel啤酒\t2.0
人头马（Remy Martin）洋酒诚印特优香槟干邑白兰地
比利时舒弗/舒佛Lachouffe啤酒
五粮液股份公司1995专卖店酒52度整箱装
水井坊臻酿八號52度500ml单瓶装
比利时啤酒进口啤酒福佳白啤酒\t3.0
德国进口Wurenbacher瓦伦丁小麦啤酒
比利时进口精酿啤酒Hoegaarden
</code></pre></div></div><h3 id="51-修改solrconfigxml配置文件增加对suggest的配置">5.1 修改solrconfig.xml配置文件增加对suggest的配置</h3><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;searchComponent</span> <span class="na">class=</span><span class="s">"solr.SpellCheckComponent"</span> <span class="na">name=</span><span class="s">"suggest"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;lst</span> <span class="na">name=</span><span class="s">"spellchecker"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;str</span> <span class="na">name=</span><span class="s">"name"</span><span class="nt">&gt;</span>suggest<span class="nt">&lt;/str&gt;</span>
        <span class="nt">&lt;str</span> <span class="na">name=</span><span class="s">"classname"</span><span class="nt">&gt;</span>org.apache.solr.spelling.suggest.Suggester<span class="nt">&lt;/str&gt;</span>
        <span class="nt">&lt;str</span> <span class="na">name=</span><span class="s">"lookupImpl"</span><span class="nt">&gt;</span>org.apache.solr.spelling.suggest.tst.TSTLookup<span class="nt">&lt;/str&gt;</span>
	<span class="c">&lt;!-- 基于schema.xml的目标索引字段 --&gt;</span>
        <span class="nt">&lt;str</span> <span class="na">name=</span><span class="s">"field"</span><span class="nt">&gt;</span>productCode<span class="nt">&lt;/str&gt;</span>
	<span class="c">&lt;!-- 限制一些不常用的词出现，值越大过滤的越多，导致的结果越少 --&gt;</span>
        <span class="nt">&lt;float</span> <span class="na">name=</span><span class="s">"threshold"</span><span class="nt">&gt;</span>0.005<span class="nt">&lt;/float&gt;</span>
        <span class="c">&lt;!--
        自定义词库字典的配置，使用自定义词库时将注释去除
        &lt;str name="sourceLocation"&gt;suggest.txt&lt;/str&gt;
        &lt;str name="spellcheckIndexDir"&gt;spellchecker&lt;/str&gt;
        --&gt;</span>
        <span class="nt">&lt;str</span> <span class="na">name=</span><span class="s">"comparatorClass"</span><span class="nt">&gt;</span>freq<span class="nt">&lt;/str&gt;</span>
        <span class="nt">&lt;str</span> <span class="na">name=</span><span class="s">"buildOnOptimize"</span><span class="nt">&gt;</span>true<span class="nt">&lt;/str&gt;</span>
        <span class="nt">&lt;str</span> <span class="na">name=</span><span class="s">"buildOnCommit"</span><span class="nt">&gt;</span>true<span class="nt">&lt;/str&gt;</span>
        <span class="c">&lt;!-- &lt;str name="sourceLocation"&gt;american-english&lt;/str&gt; --&gt;</span>
    <span class="nt">&lt;/lst&gt;</span>
<span class="nt">&lt;/searchComponent&gt;</span>
<span class="nt">&lt;requestHandler</span> <span class="na">class=</span><span class="s">"org.apache.solr.handler.component.SearchHandler"</span> <span class="na">name=</span><span class="s">"/suggest"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;lst</span> <span class="na">name=</span><span class="s">"defaults"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;str</span> <span class="na">name=</span><span class="s">"spellcheck"</span><span class="nt">&gt;</span>true<span class="nt">&lt;/str&gt;</span>
        <span class="nt">&lt;str</span> <span class="na">name=</span><span class="s">"spellcheck.dictionary"</span><span class="nt">&gt;</span>suggest<span class="nt">&lt;/str&gt;</span>
        <span class="nt">&lt;str</span> <span class="na">name=</span><span class="s">"spellcheck.onlyMorePopular"</span><span class="nt">&gt;</span>true<span class="nt">&lt;/str&gt;</span>
        <span class="nt">&lt;str</span> <span class="na">name=</span><span class="s">"spellcheck.count"</span><span class="nt">&gt;</span>5<span class="nt">&lt;/str&gt;</span>
        <span class="nt">&lt;str</span> <span class="na">name=</span><span class="s">"spellcheck.collate"</span><span class="nt">&gt;</span>true<span class="nt">&lt;/str&gt;</span>
    <span class="nt">&lt;/lst&gt;</span>
    <span class="nt">&lt;arr</span> <span class="na">name=</span><span class="s">"components"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;str&gt;</span>suggest<span class="nt">&lt;/str&gt;</span>
    <span class="nt">&lt;/arr&gt;</span>
<span class="nt">&lt;/requestHandler&gt;</span>
</code></pre></div></div><h3 id="52-对应的schemaxml文件定义">5.2 对应的schema.xml文件定义</h3><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"productId"</span> <span class="na">type=</span><span class="s">"int"</span> <span class="na">indexed=</span><span class="s">"true"</span> <span class="na">stored=</span><span class="s">"true"</span> <span class="na">required=</span><span class="s">"true"</span> <span class="na">multiValued=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"productName"</span> <span class="na">type=</span><span class="s">"text_ik"</span> <span class="na">indexed=</span><span class="s">"true"</span> <span class="na">stored=</span><span class="s">"true"</span> <span class="na">required=</span><span class="s">"true"</span> <span class="na">multiValued=</span><span class="s">"false"</span> <span class="na">termVectors=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"productPrice"</span> <span class="na">type=</span><span class="s">"currency"</span> <span class="na">indexed=</span><span class="s">"true"</span> <span class="na">stored=</span><span class="s">"true"</span> <span class="na">required=</span><span class="s">"true"</span> <span class="na">multiValued=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"productCode"</span> <span class="na">type=</span><span class="s">"string"</span> <span class="na">indexed=</span><span class="s">"true"</span> <span class="na">stored=</span><span class="s">"true"</span> <span class="na">required=</span><span class="s">"true"</span> <span class="na">multiValued=</span><span class="s">"false"</span> <span class="na">termVectors=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">"createTime"</span> <span class="na">type=</span><span class="s">"date"</span> <span class="na">indexed=</span><span class="s">"true"</span> <span class="na">stored=</span><span class="s">"true"</span> <span class="na">required=</span><span class="s">"true"</span> <span class="na">multiValued=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
</code></pre></div></div><h2 id="6-测试">6. 测试</h2><blockquote><p>配置好后重新启动 <strong>solr</strong> 容器，首次启动需要使用 <code class="highlighter-rouge">suggest/?spellcheck.build=true</code> 来创建 <strong>spellcheck</strong> 索引。</p></blockquote><p>打开浏览器进入 <strong>solr</strong> 管理界面进行 <strong>suggest</strong> 功能的验证操作。</p><p><img src="//vinnycc.oss-cn-shanghai.aliyuncs.com/20190321/solr-suggest.png" alt="solr-suggest" /></p><div class="divider"></div><blockquote id='by-nc-nd'><div> 版权所有，本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">知识共享署名-非商业性使用 3.0 未本地化版本许可协议</a>进行许可。转载请注明出处：<a href="http://www.vinny.cc//2016/08/solr-suggest/" akt="">http://www.vinny.cc//2016/08/solr-suggest/</a></div></blockquote><div class="divider"></div></article><div class="page-navigation"> <a class="next" href="/2016/09/mongodb-too-many-threads/" title="NEXT: mongodb异常Too many threads are already waiting for a connection">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="/" title="Back to Homepage">Home</a> <span> &middot; </span> <a class="prev" href="/2016/08/solr-master-slave/" title="PREV: solr-master-slave主从模式的配置实现">&gt;&gt;</a></div><!-- 书签处理 --> <script type="text/javascript" src="/assets/js/zepto.min.js"></script> <script type="text/javascript" src="/assets/js/nav.js"></script></main><!-- service worker check update bar --><div id="notification">A new version of this app is available. Click <a id="reload">here</a> to update.</div></body></html>