<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"> <!-- pwa meta begin --><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#4e8ef7"><meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="msapplication-tap-highlight" content="no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"> <!-- pwa meta end --><title>Centos7安装zabbix-server监控服务端</title><meta name="description" content=""><meta name="keywords" content="zabbix"><link rel="icon" href="/assets/favicon.ico"><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/2017/02/zabbix-server-install/"><link rel="alternate" type="application/atom+xml" title="Vinny Wong's Blog" href="/feed.xml" /></head><body> <!-- search --><div class="searchform"> <a href="javascript:void(0);" class="searchicon"></a> <input type="text" id="keyword"/> <a href="javascript:void(0);" class="clear"></a><ul class="suggest"></ul></div><script src="/assets/jquery-1.9.1.min.js"></script> <script src="/assets/main.js"></script><nav class="header-nav"> <a class="page-link" href="/">HOME</a> / <a class="page-link" href="/categories/">CATEGORY</a> / <a class="page-link" href="/feed.xml">FEED</a> / <a class="page-link" href="/about/">ABOUT</a></nav><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>Centos7安装zabbix-server监控服务端</h1><time>2017-02-14</time></div><div class="divider"></div><ul id="markdown-toc"><li><a href="#centos7安装zabbix-server监控服务端" id="markdown-toc-centos7安装zabbix-server监控服务端">Centos7安装zabbix-server监控服务端</a><ul><li><a href="#1-安装zabbix仓库源" id="markdown-toc-1-安装zabbix仓库源">1. 安装zabbix仓库源</a></li><li><a href="#2-使用yum安装zabbix组件" id="markdown-toc-2-使用yum安装zabbix组件">2. 使用yum安装zabbix组件</a></li><li><a href="#3-安装mysql数据库服务器" id="markdown-toc-3-安装mysql数据库服务器">3. 安装mysql数据库服务器</a><ul><li><a href="#31-检查本机是否已经安装mysql" id="markdown-toc-31-检查本机是否已经安装mysql">3.1 检查本机是否已经安装mysql</a></li><li><a href="#32-安装mysql官方源" id="markdown-toc-32-安装mysql官方源">3.2 安装mysql官方源</a></li><li><a href="#33-使用yum安装mysql" id="markdown-toc-33-使用yum安装mysql">3.3 使用yum安装mysql</a></li><li><a href="#34-启动mysql服务器" id="markdown-toc-34-启动mysql服务器">3.4 启动mysql服务器</a></li><li><a href="#35-修改root默认密码" id="markdown-toc-35-修改root默认密码">3.5 修改root默认密码</a></li></ul></li><li><a href="#4-创建zabbix数据库及用户" id="markdown-toc-4-创建zabbix数据库及用户">4. 创建zabbix数据库及用户</a></li><li><a href="#5-初始化zabbix表及相关数据" id="markdown-toc-5-初始化zabbix表及相关数据">5. 初始化zabbix表及相关数据</a></li><li><a href="#6-配置zabbix服务的配置文件" id="markdown-toc-6-配置zabbix服务的配置文件">6. 配置zabbix服务的配置文件</a></li><li><a href="#7-编辑zabbix的php配置文件" id="markdown-toc-7-编辑zabbix的php配置文件">7. 编辑zabbix的php配置文件</a></li><li><a href="#8-启动zabbix服务" id="markdown-toc-8-启动zabbix服务">8. 启动zabbix服务</a></li><li><a href="#9-启动http服务" id="markdown-toc-9-启动http服务">9. 启动http服务</a></li><li><a href="#10-开放相应的防火墙规则" id="markdown-toc-10-开放相应的防火墙规则">10. 开放相应的防火墙规则</a></li><li><a href="#11-浏览器打开web控制台" id="markdown-toc-11-浏览器打开web控制台">11. 浏览器打开web控制台</a></li><li><a href="#附录a邮件脚步报警" id="markdown-toc-附录a邮件脚步报警">附录A：邮件脚步报警</a></li></ul></li></ul><hr /><h1 id="centos7安装zabbix-server监控服务端">Centos7安装zabbix-server监控服务端</h1><h2 id="1-安装zabbix仓库源">1. 安装zabbix仓库源</h2><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rpm <span class="nt">-ivh</span> http://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/zabbix-release-3.2-1.el7.noarch.rpm
</code></pre></div></div><h2 id="2-使用yum安装zabbix组件">2. 使用yum安装zabbix组件</h2><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum <span class="nb">install</span> <span class="nt">-y</span> zabbix-server-mysql zabbix-web-mysql
</code></pre></div></div><h2 id="3-安装mysql数据库服务器">3. 安装mysql数据库服务器</h2><h3 id="31-检查本机是否已经安装mysql">3.1 检查本机是否已经安装mysql</h3><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rpm <span class="nt">-qa</span> | <span class="nb">grep </span>mysql
</code></pre></div></div><h3 id="32-安装mysql官方源">3.2 安装mysql官方源</h3><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rpm <span class="nt">-ivh</span> http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm
</code></pre></div></div><h3 id="33-使用yum安装mysql">3.3 使用yum安装mysql</h3><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum <span class="nb">install</span> <span class="nt">-y</span> mysql mysql-server
</code></pre></div></div><h3 id="34-启动mysql服务器">3.4 启动mysql服务器</h3><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl start mysqld.service
</code></pre></div></div><h3 id="35-修改root默认密码">3.5 修改root默认密码</h3><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span>
<span class="n">use</span> <span class="n">mysql</span><span class="p">;</span>
<span class="k">update</span> <span class="k">user</span> <span class="k">set</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">(</span><span class="s1">'root'</span><span class="p">)</span> <span class="k">where</span> <span class="k">user</span><span class="o">=</span><span class="s1">'root'</span><span class="p">;</span>
<span class="n">exit</span><span class="p">;</span>
</code></pre></div></div><h2 id="4-创建zabbix数据库及用户">4. 创建zabbix数据库及用户</h2><div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">create</span> <span class="k">database</span> <span class="n">zabbix</span> <span class="n">character</span> <span class="k">set</span> <span class="n">utf8</span> <span class="k">collate</span> <span class="n">utf8_bin</span><span class="p">;</span>
<span class="k">grant</span> <span class="k">all</span> <span class="k">privileges</span> <span class="k">on</span> <span class="n">zabbix</span><span class="p">.</span><span class="o">*</span> <span class="k">to</span> <span class="n">zabbix</span><span class="o">@</span><span class="n">localhost</span> <span class="n">identified</span> <span class="k">by</span> <span class="s1">'zabbix'</span><span class="p">;</span>
<span class="n">flush</span> <span class="k">privileges</span><span class="p">;</span>
<span class="n">quit</span><span class="p">;</span>
</code></pre></div></div><h2 id="5-初始化zabbix表及相关数据">5. 初始化zabbix表及相关数据</h2><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zcat /usr/share/doc/zabbix-server-mysql-3.2.<span class="k">*</span>/create.sql.gz | mysql <span class="nt">-uzabbix</span> <span class="nt">-p</span> zabbix
</code></pre></div></div><h2 id="6-配置zabbix服务的配置文件">6. 配置zabbix服务的配置文件</h2><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># vi /etc/zabbix/zabbix_server.conf
DBHost=localhost
DBName=zabbix
DBUser=zabbix
DBPassword=zabbix
</code></pre></div></div><h2 id="7-编辑zabbix的php配置文件">7. 编辑zabbix的php配置文件</h2><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># vi /etc/httpd/conf.d/zabbix.conf
php_value max_execution_time 300
php_value memory_limit 128M
php_value post_max_size 16M
php_value upload_max_filesize 2M
php_value max_input_time 300
php_value always_populate_raw_post_data -1
# 时区配置
php_value date.timezone Asia/Shanghai
</code></pre></div></div><h2 id="8-启动zabbix服务">8. 启动zabbix服务</h2><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl start zabbix-server.service
</code></pre></div></div><blockquote><p>若出现 <strong>zabbix-server.service never wrote its PID file. Failing.</strong> 的错误，在终端执行<code class="highlighter-rouge">setenforce 0</code>命令即可。</p></blockquote><h2 id="9-启动http服务">9. 启动http服务</h2><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl start httpd
</code></pre></div></div><h2 id="10-开放相应的防火墙规则">10. 开放相应的防火墙规则</h2><p>防火墙规则不是必须的，若服务器配置了防火墙规则则应加上如下的规则。</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 运行localhost访问任意端口服务</span>
iptables <span class="nt">-A</span> INPUT <span class="nt">-i</span> lo <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-o</span> lo <span class="nt">-j</span> ACCEPT
<span class="c"># 调用agent客户端端口</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 10050 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--sport</span> 10050 <span class="nt">-j</span> ACCEPT
<span class="c"># 邮件报警端口</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 25 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--sport</span> 25 <span class="nt">-j</span> ACCEPT
<span class="c"># web监控时http和https端口</span>
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 80 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--sport</span> 80 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 443 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--sport</span> 443 <span class="nt">-j</span> ACCEPT
</code></pre></div></div><h2 id="11-浏览器打开web控制台">11. 浏览器打开web控制台</h2><p>输入连接 <strong>http://xxx.xxx.xxx.xxx/zabbix</strong> 进行界面配置即可完成。默认的用户名密码是 <strong>Admin</strong>/<strong>zabbix</strong>。</p><h2 id="附录a邮件脚步报警">附录A：邮件脚步报警</h2><p>对于自定义的媒介脚本，应该放在”<strong>/usr/local/zabbix/share/zabbix/alertscripts</strong>“目录中，这样在配置自定义媒介时，zabbix-server才会识别到。</p><p>下面是python语言编写的自动发送邮件的脚本<strong>mail.py</strong>。</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#coding:utf-8</span>

<span class="kn">import</span> <span class="nn">smtplib</span>
<span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">mail_host</span> <span class="o">=</span> <span class="s">'smtp.163.com'</span>
<span class="n">mail_user</span> <span class="o">=</span> <span class="s">'vinny@163.com'</span>
<span class="n">mail_pass</span> <span class="o">=</span> <span class="s">'vinny123'</span>
<span class="n">mail_postfix</span> <span class="o">=</span> <span class="s">'163.com'</span>

<span class="k">def</span> <span class="nf">send_mail</span><span class="p">(</span><span class="n">to_list</span><span class="p">,</span><span class="n">subject</span><span class="p">,</span><span class="n">content</span><span class="p">):</span>
    <span class="n">me</span> <span class="o">=</span> <span class="s">"Zabbix监控告警平台"</span><span class="o">+</span><span class="s">"&lt;"</span><span class="o">+</span><span class="n">mail_user</span><span class="o">+</span><span class="s">"@"</span><span class="o">+</span><span class="n">mail_postfix</span><span class="o">+</span><span class="s">"&gt;"</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s">'plain'</span><span class="p">,</span> <span class="s">'utf-8'</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">[</span><span class="s">'Subject'</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
    <span class="n">msg</span><span class="p">[</span><span class="s">'From'</span><span class="p">]</span> <span class="o">=</span> <span class="n">me</span>
    <span class="n">msg</span><span class="p">[</span><span class="s">'to'</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_list</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">mail_host</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">mail_user</span><span class="p">,</span><span class="n">mail_pass</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_list</span><span class="p">,</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
        <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">send_mail</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</code></pre></div></div><div class="divider"></div><blockquote id='by-nc-nd'><div> 版权所有，本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">知识共享署名-非商业性使用 3.0 未本地化版本许可协议</a>进行许可。转载请注明出处：<a href="http://localhost:4000//2017/02/zabbix-server-install/" akt="">http://localhost:4000//2017/02/zabbix-server-install/</a></div></blockquote><div class="divider"></div><a class="w-search active" href="#" title="forward to search">⊙</a> <a class="w-catalog active" href="javascript:void(0);" title="open to catalog">≣</a></article><div class="page-navigation"> <a class="next" href="/2017/02/zabbix-agent-install/" title="NEXT: Centos7安装zabbix-agent监控客户端">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="/" title="Back to Homepage">Home</a> <span> &middot; </span> <a class="prev" href="/2017/02/linux-add-swap-space/" title="PREV: Linux增加swap分区">&gt;&gt;</a></div></main><!--<div class="footer"> --> <!-- <span class="block">Made with &hearts; using <a href="http://jekyllrb.com/">Jekyll</a> &amp; <a href="https://github.com/heiswayi/the-plain" title="The Plain theme by Heiswayi Nrird">The Plain</a> &middot; &lt;/&gt; on <a href="https://github.com/wangjunneil" title="Hosted on GitHub">GitHub</a></span> --> <!-- <span class="block"><a href="https://vinny.cc">Vinny's Blog</a> © 2018 - All Rights Reserved</span></div>--></body></html>