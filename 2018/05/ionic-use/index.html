<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"> <!-- pwa meta begin --><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#000"><meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="msapplication-tap-highlight" content="no"> <!-- IOS不会读取manifest中的icon，用此配置进行适配 --><link rel="apple-touch-icon" href="assets/icons/icon-96x96.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/icon-180x180.png"><link rel="apple-touch-icon" sizes="167x167" href="/assets/icons/icon-167x167.png"> <!-- ios修复splash黑屏 --><link href="/assets/icons/apple_splash_1125.png" sizes="1125x2436" rel="apple-touch-startup-image" /><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"> <!-- pwa meta end --><title>使 ionic 在项目中的最佳实践</title><meta name="description" content="Ionic 是当今流行手机端 Hybird 技术，当前已到在v3的版本，其特点就是高效、成本低、快速开发和一次编码多平台适用的原则。研发人员只需具备良好的前端开发（HTML、CSS、Javascript）基础即可进行开发。其核心技术利用手机浏览器的 WebView 进行界面渲染，并且具备丰富的 Native 化库。"><meta name="keywords" content="ionic"><link rel="icon" href="/assets/favicon.ico"><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/2018/05/ionic-use/"><link rel="alternate" type="application/atom+xml" title="Vinny Wong's Blog" href="/feed.xml" /></head><body> <!-- 全局页面loading --><div class="loading"><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div><!-- search --><div class="searchform"> <a href="javascript:void(0);" class="searchicon"></a> <input type="text" id="keyword"/> <a href="javascript:void(0);" class="clear"></a><ul class="suggest"></ul></div><script src="/assets/jquery-1.9.1.min.js"></script> <!-- 图片懒加载 --> <!-- <script src="//cdn.jsdelivr.net/npm/lozad"></script> --> <script src="/assets/main.js"></script><nav class="header-nav"> <a class="page-link" href="/">HOME</a> / <a class="page-link" href="/categories/">CATEGORY</a> / <a class="page-link" href="/feed.xml">FEED</a> / <a class="page-link" href="/about/">ABOUT</a></nav><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article> <!-- 目录导航，在nav,js中进行渲染 --><div class="w-catalog"></div><div class="w-catalog-btn">目录</div><div class="center"><h1>使 ionic 在项目中的最佳实践</h1><time>2018-05-12</time></div><div class="divider"></div><ul id="markdown-toc"><li><a href="#1-初始工程" id="markdown-toc-1-初始工程">1. 初始工程</a></li><li><a href="#2-运行工程" id="markdown-toc-2-运行工程">2. 运行工程</a></li><li><a href="#3-开始编码" id="markdown-toc-3-开始编码">3. 开始编码</a><ul><li><a href="#31-创建页面" id="markdown-toc-31-创建页面">3.1 创建页面</a></li><li><a href="#32-创建组件" id="markdown-toc-32-创建组件">3.2 创建组件</a></li><li><a href="#33-创建服务" id="markdown-toc-33-创建服务">3.3 创建服务</a></li><li><a href="#34-生成更多" id="markdown-toc-34-生成更多">3.4 生成更多</a></li><li><a href="#35-子父传参" id="markdown-toc-35-子父传参">3.5 子父传参</a></li><li><a href="#36-页面跳转" id="markdown-toc-36-页面跳转">3.6 页面跳转</a></li><li><a href="#37-控件取值" id="markdown-toc-37-控件取值">3.7 控件取值</a></li><li><a href="#38-色彩变量" id="markdown-toc-38-色彩变量">3.8 色彩变量</a></li><li><a href="#39-惰性加载" id="markdown-toc-39-惰性加载">3.9 惰性加载</a></li><li><a href="#310-自定义组件-" id="markdown-toc-310-自定义组件-">3.10 自定义组件 ??</a></li><li><a href="#311-模态框样式" id="markdown-toc-311-模态框样式">3.11 模态框样式</a></li><li><a href="#312-滚动的列表" id="markdown-toc-312-滚动的列表">3.12 滚动的列表</a></li><li><a href="#313-本地化插件" id="markdown-toc-313-本地化插件">3.13 本地化插件</a></li></ul></li><li><a href="#4-打包发布" id="markdown-toc-4-打包发布">4. 打包发布</a><ul><li><a href="#41-android" id="markdown-toc-41-android">4.1 Android</a><ul><li><a href="#411-名称修改" id="markdown-toc-411-名称修改">4.1.1 名称修改</a></li><li><a href="#412-签名打包" id="markdown-toc-412-签名打包">4.1.2 签名打包</a></li></ul></li><li><a href="#42-ios" id="markdown-toc-42-ios">4.2 IOS</a><ul><li><a href="#421-名称修改" id="markdown-toc-421-名称修改">4.2.1 名称修改</a></li><li><a href="#422-应用市场-" id="markdown-toc-422-应用市场-">4.2.2 应用市场 ??</a></li></ul></li><li><a href="#43-webapp" id="markdown-toc-43-webapp">4.3 Webapp</a></li></ul></li><li><a href="#附录a-cli其他命令" id="markdown-toc-附录a-cli其他命令">附录A cli其他命令</a></li><li><a href="#附录b-ionic的版本" id="markdown-toc-附录b-ionic的版本">附录B ionic的版本</a></li></ul><p><strong><a href="https://ionicframework.com/">Ionic</a></strong> 是当今流行手机端 Hybird 技术，当前已到在v3的版本，其特点就是高效、成本低、快速开发和一次编码多平台适用的原则。研发人员只需具备良好的前端开发（HTML、CSS、Javascript）基础即可进行开发。其核心技术利用手机浏览器的 WebView 进行界面渲染，并且具备丰富的 Native 化库。</p><p>本文以实践为基础（跳过安装等细节），详细说明 ionic 在生成环境中的从零到有的研发过程。</p><h2 id="1-初始工程">1. 初始工程</h2><p>开始之初，需要决定要开发的 ionic app 的_布局结构_，使用 <a href="https://ionicframework.com/docs/cli/">ionic cli</a> 中提供的 <code class="highlighter-rouge">start</code> 命令可以查看支持的模板有哪些。</p><p><img src="http://ohdpyqlwy.bkt.clouddn.com/ionic-basic-1.png" alt="ionic_cli_template" /></p><p>常用的布局有 <strong>tabs</strong> 和 <strong>sidemenu</strong>，这里我们创建一个 tab 的工程结构，使用如下命令初始化工程：</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ionic start [工程名称] [模板名称]</span>
<span class="nv">$ </span>ionic start myapp tabs
</code></pre></div></div><p>使用如上命令会得到一个标准的 ionic tab 工程，但是这真的对吗？如果用上面的方式创建工程，在后续发布会很麻烦，最基本的需要确定 app 在屏幕上的名称及 app 的包名，包名的重要性体现在发布到苹果的 appstore 上，虽然可以改，但很麻烦，为什么在开始不规避此类问题呢？</p><p>完整的创建工程命令应该是下面的方式：</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ionic start vinnyBlogApp tabs <span class="nt">--display-name</span> <span class="s2">"Vinny博客"</span> <span class="nt">--no-link</span> <span class="nt">--bundle-id</span> <span class="s2">"cc.vinny"</span>
</code></pre></div></div><p><img src="http://ohdpyqlwy.bkt.clouddn.com/ionic-basic-2.png" alt="ionic_basic_2" /></p><p>经过一会的等待，命令执行完成，ionic 工程的初始化工作已经结束，此时进入工程目录，使用 <code class="highlighter-rouge">ionic info</code> 检查下当前工程的环境信息，ionic、cli、angular、cordova的版本是什么，当前的 Android 和 IOS 开发环境等等，这个很重要，版本错乱会导致莫名的问题，<strong>经常会在别人 checkout 你初始化的代码时，因为你的环境与别人电脑上的不一定一致，往往需要降级和升级ionic的版本</strong>。</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ionic info
</code></pre></div></div><p><img src="http://ohdpyqlwy.bkt.clouddn.com/ionic-basic-3.png" alt="ionic-basic-3" /></p><blockquote><p>如果是你 checkout 别人的 ionic 工程代码，应该在其根路径下执行 <code class="highlighter-rouge">npm install</code> 进行初始化。</p></blockquote><p>目前创建的只是一个可以在浏览器中运行的”Web”程序，现在添加对特定平台的支持，如下：</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ionic cordova platform add ios
<span class="nv">$ </span>ionic cordova platform add android
</code></pre></div></div><p>上述命令执行完会在工程中创建 <em>platform</em> 的目录，包含了 ios 和 android 工程代码，及加入了基础的 native 插件 package.json 文件中。</p><p><img src="http://ohdpyqlwy.bkt.clouddn.com/ionic-basic-4.png" alt="ionic-basic-4" /></p><h2 id="2-运行工程">2. 运行工程</h2><p>工程搭建完毕后，运行起来以保证可以正常使用</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 在浏览器中运行</span>
<span class="nv">$ </span>ionic serve <span class="nt">--lab</span> <span class="nt">-c</span>

<span class="c"># 在模拟器中运行</span>
<span class="nv">$ </span>ionic cordova run ios
<span class="nv">$ </span>ionic cordova run ios <span class="nt">--target</span><span class="o">=</span><span class="s2">"iPhone-X"</span>
<span class="nv">$ </span>ionic cordova run android
<span class="nv">$ </span>ionic cordova run android <span class="nt">--livereload</span>
</code></pre></div></div><p>除非涉及到 native 开发，否则基本上都是在浏览器中进行开发调试，但也需要经常的在模拟器中运行一下，以确保编写的代码可以适用于移动端。</p><p>在模拟器中运行，需要电脑具备Android或者IOS的开发环境，当编写涉及硬件功能时，如手机探头，可能就需要在真机中运行，当然也有折中方案，请参见 <a href="https://vinny.cc/2018/05/ionic-dev-app/">让 ionic 使用 ionic dev app 在真机上进行测试</a>。</p><p><img src="http://ohdpyqlwy.bkt.clouddn.com/ionic-basic-5.png" alt="ionic-basic-5" /></p><h2 id="3-开始编码">3. 开始编码</h2><p>本章节只记录开发中的疑难问题与解决方法</p><h3 id="31-创建页面">3.1 创建页面</h3><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ionic g page welcome
</code></pre></div></div><p>上述命令的 “<strong>g</strong>” 是 “<strong>generate</strong>” 的缩写，上述命令执行完成后会在 <em>src/pages</em> 下生成 <em>welcome</em> 的文件夹，里面包含一个页面所有所需的文件。</p><p>生成页面后需要在 <em>app.module.ts</em> 中进行注册使用（非懒加载）</p><div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">WelcomePage</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'../pages/welcome/welcome'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="na">declarations</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">...</span>  
    <span class="nx">WelcomePage</span>
  <span class="p">],</span>
  <span class="na">entryComponents</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">...</span>
    <span class="nx">WelcomePage</span>
  <span class="p">],</span>
<span class="p">})</span>
</code></pre></div></div><h3 id="32-创建组件">3.2 创建组件</h3><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ionic g component cute
</code></pre></div></div><p>命令完成后会在 <em>src/components/</em> 目录下生成该组件，同样的，也需要和 page 一样在 <em>app.module.ts</em> 中注册。</p><h3 id="33-创建服务">3.3 创建服务</h3><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ionic g provider authApi
</code></pre></div></div><p>会在 <em>src/providers/</em> 目录下生成服务文件，自动在 <em>app.module.ts</em> 中注册。</p><div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">AuthApiProvider</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'../providers/auth-api/auth-api'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">...</span>
    <span class="nx">AuthApiProvider</span>
  <span class="p">]</span>
<span class="p">})</span>
</code></pre></div></div><h3 id="34-生成更多">3.4 生成更多</h3><p>上面介绍了 <strong>Page</strong>、<strong>Component</strong>、<strong>Provider</strong> 的生成，基本可以满足 ionic 开发，其实如果熟悉 ionic 结构，可以自己手动编写此类型的文件，不需要使用 ionic cli 的功能，使用 cli 主要是方便些，下面是 cli 能为我们生成哪些东西：</p><p><img src="http://ohdpyqlwy.bkt.clouddn.com/ionic-basic-7.png" alt="ionic-basic-7" /></p><h3 id="35-子父传参">3.5 子父传参</h3><p>父页面传参到子页面简单，反过来当子页面返回或者关闭时如何将参数传递给父页面则需要特殊处理，下面是两种方案可以实现。</p><p><strong>1. 事件订阅方式</strong></p><div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// == 父页面 ==</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Events</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'ionic-angular'</span><span class="p">;</span>

<span class="kd">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">events</span><span class="p">:</span> <span class="nx">Events</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="nx">chooseSrv</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">'server:choose'</span><span class="p">,</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span> <span class="c1">// 传递来的参数</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">(</span><span class="s1">'server:choose'</span><span class="p">);</span>
  <span class="p">});</span>
 
  <span class="c1">// 跳转到子页面</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">navCtrl</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">SrvhiyPage</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// == 子页面 ==</span>
<span class="nx">choose</span><span class="p">(</span><span class="nx">index</span><span class="p">:</span><span class="nx">number</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">navCtrl</span><span class="p">.</span><span class="nx">pop</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">// 子页面关闭</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">'server:choose'</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">srvs</span><span class="p">[</span><span class="nx">index</span><span class="p">]);</span> <span class="c1">// this.srvs[index]是传递的参数</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div><p><strong>2. ionViewWillEnter的方式</strong></p><div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// == 父页面 ==</span>
<span class="nx">ionViewWillEnter</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">navParams</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'myNewKey'</span><span class="p">)</span><span class="o">||</span> <span class="kc">null</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// == 子页面 ==</span>
<span class="nx">choose</span><span class="p">(</span><span class="nx">index</span><span class="p">:</span><span class="nx">number</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">navCtrl</span><span class="p">.</span><span class="nx">getPrevious</span><span class="p">().</span><span class="nx">data</span><span class="p">.</span><span class="nx">myNewKey</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">srvs</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">navCtrl</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="36-页面跳转">3.6 页面跳转</h3><p>在 Typescript 中跳转</p><div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">this</span><span class="p">.</span><span class="nx">navCtrl</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">LoginPage</span><span class="p">);</span>
<span class="k">this</span><span class="p">.</span><span class="nx">navCtrl</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">LoginPage</span><span class="p">,</span> <span class="p">{</span><span class="err">参数</span><span class="p">},</span> <span class="p">{</span><span class="na">animate</span><span class="p">:</span><span class="kc">false</span><span class="p">});</span>
<span class="kd">const</span> <span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">getRootNav</span><span class="p">();</span>
<span class="nx">root</span><span class="p">.</span><span class="nx">popToRoot</span><span class="p">();</span>
</code></pre></div></div><p>在 Html 中跳转</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">ion-button</span> <span class="err">[</span><span class="na">navPush</span><span class="err">]="</span><span class="na">pushPage</span><span class="err">"</span> <span class="err">[</span><span class="na">navParams</span><span class="err">]="</span><span class="na">params</span><span class="err">"</span><span class="nt">&gt;</span>Go<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;button</span> <span class="na">ion-button</span> <span class="na">navPop</span><span class="nt">&gt;</span>Go Back<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div><h3 id="37-控件取值">3.7 控件取值</h3><p>控件取值，如输入框 ion-input 的取值，除了可以使用 <strong>ngModel</strong> 的方式，也可以使用 <strong>@ViewChild</strong> 的方式，如下：</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ion-input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="err">[(</span><span class="na">ngModel</span><span class="err">)]="</span><span class="na">username</span><span class="err">"</span><span class="nt">&gt;&lt;/ion-input&gt;</span>
<span class="nt">&lt;ion-input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="err">#</span><span class="na">password</span><span class="nt">&gt;&lt;/ion-input&gt;</span>
</code></pre></div></div><div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">private</span> <span class="nx">username</span><span class="p">:</span> <span class="nx">string</span><span class="p">;</span> <span class="c1">// 获取的是控件值</span>
<span class="p">@</span><span class="nd">ViewChild</span><span class="p">(</span><span class="s1">'password'</span><span class="p">)</span> <span class="nx">password</span><span class="p">;</span> <span class="c1">// 获取的是控件元素</span>

<span class="c1">// 取值</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">password</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</code></pre></div></div><h3 id="38-色彩变量">3.8 色彩变量</h3><p>ionic 在 <em>theme/variables.scss</em> 中已经预定义几种色彩，也可以自定义色彩变量，如：</p><div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$colors</span><span class="p">:</span> <span class="p">(</span>
  <span class="n">primary</span><span class="o">:</span>    <span class="mh">#488aff</span><span class="o">,</span>
  <span class="n">secondary</span><span class="o">:</span>  <span class="mh">#32db64</span><span class="o">,</span>
  <span class="n">danger</span><span class="o">:</span>     <span class="mh">#f53d3d</span><span class="o">,</span>
  <span class="n">light</span><span class="o">:</span>      <span class="mh">#f4f4f4</span><span class="o">,</span>
  <span class="n">dark</span><span class="o">:</span>       <span class="mh">#222</span><span class="o">,</span>
  <span class="n">mycolor</span><span class="o">:</span>	  <span class="mh">#098721</span> <span class="o">//</span> <span class="err">自定义颜色</span>
<span class="p">);</span>
</code></pre></div></div><p>颜色变量的使用</p><div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">background</span><span class="p">:</span> <span class="nf">color</span><span class="p">(</span><span class="nv">$colors</span><span class="o">,</span> <span class="n">mycolor</span><span class="p">);</span>
</code></pre></div></div><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">ion-button</span> <span class="na">block</span> <span class="na">color=</span><span class="s">"mycolor"</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/button&gt;</span>
</code></pre></div></div><h3 id="39-惰性加载">3.9 惰性加载</h3><p>在 <a href="#31-创建页面">3.1 创建页面</a> 和 <a href="#32-创建组件">3.2 创建组件</a> 中知道，都需要在 <em>app.module.ts</em> 中进行注册，然后在需要的地方进行导入才可以使用。使用懒加载的方式则不需要进行注册和导入，使用字符串的方式就可以使用创建的页面或者组件，整体代码更加简洁。</p><ol><li><p>删除所有 <em>src/pages</em> 下的页面，全部使用 <code class="highlighter-rouge">ionic g page</code> 的方式重新生成</p></li><li><p>删除 <em>app.module.ts</em> 中的页面导入，只留下 MyApp 即可</p><div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">NgModule</span><span class="p">({</span>
  <span class="na">declarations</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">MyApp</span>
  <span class="p">],</span>
  <span class="na">entryComponents</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">MyApp</span>
  <span class="p">],</span>
  <span class="p">...</span>
<span class="p">})</span>
</code></pre></div></div></li><li><p>将涉及到的页面全部修改成 string 类型，之后使用 string 类型的页面命名即可</p><div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// import { AboutPage } from '../about/about';</span>
<span class="c1">// import { ContactPage } from '../contact/contact';</span>
<span class="c1">// import { HomePage } from '../home/home';</span>
   
<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">templateUrl</span><span class="p">:</span> <span class="s1">'tabs.html'</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">TabsPage</span> <span class="p">{</span>
  <span class="nx">tab1Root</span> <span class="o">=</span> <span class="s1">'HomePage'</span><span class="p">;</span>
  <span class="nx">tab2Root</span> <span class="o">=</span> <span class="s1">'AboutPage'</span><span class="p">;</span>
  <span class="nx">tab3Root</span> <span class="o">=</span> <span class="s1">'ContactPage'</span><span class="p">;</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div></li></ol><h3 id="310-自定义组件-">3.10 自定义组件 ??</h3><h3 id="311-模态框样式">3.11 模态框样式</h3><div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">modal</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">modalCtrl</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">ModalPage</span><span class="p">);</span>
<span class="nx">modal</span><span class="p">.</span><span class="nx">present</span><span class="p">();</span>
</code></pre></div></div><p>上面是模态框的基本使用，在手机上默认是全屏覆盖的方式，在pad上则是居中显示，如果需要在pad上也类似于手机上全覆盖可以使用如下样式修改</p><ol><li><p>在 <em>app.scss</em> 中定义</p><div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.login-modal</span> <span class="nc">.modal-wrapper</span><span class="p">{</span>
    <span class="nl">height</span><span class="p">:</span> <span class="m">100%</span> <span class="o">!</span><span class="n">important</span><span class="p">;</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span> <span class="o">!</span><span class="n">important</span><span class="p">;</span>
    <span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="nl">bottom</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="nl">right</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
    <span class="nl">margin</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>
    <span class="nl">border-radius</span><span class="p">:</span> <span class="m">0px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div></li><li><p>在调用的地方指定cssClass</p><div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">modal</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">modalCtrl</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">'LoginPage'</span><span class="p">,</span> <span class="p">{},</span> <span class="p">{</span><span class="na">cssClass</span><span class="p">:</span> <span class="s1">'login-modal'</span><span class="p">});</span>
<span class="nx">modal</span><span class="p">.</span><span class="nx">present</span><span class="p">();</span>  
</code></pre></div></div></li></ol><h3 id="312-滚动的列表">3.12 滚动的列表</h3><p>这里需要使用 <strong>ion-scroll</strong> 进行控制，不止在 ion-list 中可以使用，也可以在其他地方使用</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ion-scroll</span> <span class="na">scrollY=</span><span class="s">"true"</span> <span class="na">direction=</span><span class="s">"xy"</span> <span class="na">overflow-scroll=</span><span class="s">"true"</span><span class="nt">&gt;</span>
    
    <span class="nt">&lt;ion-list</span> <span class="na">no-margin</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"product-item"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ion-item</span> <span class="err">*</span><span class="na">ngFor=</span><span class="s">"let i of [1,2,3,4,5,6,7,8]"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;ion-thumbnail</span> <span class="na">item-start</span><span class="nt">&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"http://via.placeholder.com/300x200"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;/ion-thumbnail&gt;</span>
          <span class="nt">&lt;h2&gt;</span>xxx<span class="nt">&lt;/h2&gt;</span>
          <span class="nt">&lt;p&gt;</span>x 1<span class="nt">&lt;/p&gt;</span>
          <span class="nt">&lt;ion-note</span> <span class="na">item-end</span><span class="nt">&gt;</span>16.0<span class="nt">&lt;/ion-note&gt;</span>
        <span class="nt">&lt;/ion-item&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/ion-list&gt;</span>
    
<span class="nt">&lt;/ion-scroll&gt;</span>
</code></pre></div></div><div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">ion-scroll</span> <span class="p">{</span>
    <span class="nl">white-space</span><span class="p">:</span> <span class="nb">nowrap</span><span class="p">;</span>
    <span class="nl">height</span><span class="p">:</span> <span class="m">400px</span><span class="p">;</span> <span class="c1">// 控制高度</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="313-本地化插件">3.13 本地化插件</h3><p>ionic 提供丰富的 <a href="https://ionicframework.com/docs/native/">本地化插件</a> 可用使用，当进行发布 AppStore 时，在审核过程中如果不进行权限描述，则会审核不通过。下面进行某个插件的安装：</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 安装二维码扫描插件</span>
<span class="nv">$ </span>ionic cordova plugin add phonegap-plugin-barcodescanner
<span class="nv">$ </span>npm <span class="nb">install</span> <span class="nt">--save</span> @ionic-native/barcode-scanner
</code></pre></div></div><p>给 barcodescanner 插件添加描述，编辑 <em>config.xml</em> 文件，在 &lt;platform name="ios"&gt; 中添加如下内容：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;edit-config</span> <span class="na">target=</span><span class="s">"NSCameraUsageDescription"</span> <span class="na">file=</span><span class="s">"*-Info.plist"</span> <span class="na">mode=</span><span class="s">"merge"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;string&gt;</span>使用探头进行扫码登录<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/edit-config&gt;</span>
</code></pre></div></div><p>当执行 <code class="highlighter-rouge">build</code> 或者 <code class="highlighter-rouge">run</code> 命令时会自动添加到 <em>*-Info.plist</em> 中，<strong>每个本地化插件都需要添加描述，具体参考插件介绍</strong>。</p><h2 id="4-打包发布">4. 打包发布</h2><h3 id="41-android">4.1 Android</h3><h4 id="411-名称修改">4.1.1 名称修改</h4><p>编辑 <em>config.xml</em> 文件，在节点 <em>&lt;platform name="android"&gt;</em> 下增加如下：</p><div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;platform</span> <span class="na">name=</span><span class="s">"android"</span><span class="nt">&gt;</span>
    ...
    <span class="nt">&lt;name&gt;</span>Vinny博客<span class="nt">&lt;/name&gt;</span>
    ...
<span class="nt">&lt;/platform&gt;</span>
</code></pre></div></div><p>当晕车 <code class="highlighter-rouge">run</code> 或者 <code class="highlighter-rouge">build</code> 命令时会改变 <em>platforms/android/res/values/strings.xml</em> 文件 App Name 的值，以完成对 Android App 的名称修改。</p><h4 id="412-签名打包">4.1.2 签名打包</h4><p>这里使用的是 ionic 自带的打包功能，也可以使用 Android Studio 进行打包，下面的命令会在 platforms/android/build/outputs/apk/ 目录下生成未签名的 <strong>android-release-unsigned.apk</strong> 安装包。</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ionic cordova build android <span class="nt">--prod</span> <span class="nt">--release</span>
</code></pre></div></div><p>对 <strong>android-release-unsigned.apk</strong> 进行签名、优化及验证处理</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 进入安装包所在路径</span>
<span class="nv">$ </span><span class="nb">cd </span>platforms/android/build/outputs/apk/

<span class="c"># 生成私钥</span>
<span class="nv">$ </span>keytool <span class="nt">-genkey</span> <span class="nt">-v</span> <span class="nt">-keystore</span> vinny-release-key.jks <span class="nt">-keyalg</span> RSA <span class="nt">-keysize</span> 2048 <span class="nt">-validity</span> 10000 <span class="nt">-alias</span> vinny
<span class="c"># 使用私钥进行签名</span>
<span class="nv">$ </span>jarsigner <span class="nt">-verbose</span> <span class="nt">-sigalg</span> SHA1withRSA <span class="nt">-digestalg</span> SHA1 <span class="nt">-keystore</span> vinny-release-key.jks android-release-unsigned.apk vinny
<span class="c"># 使用zipalign工具对安装包进行优化</span>
<span class="nv">$ $ANDROID_HOME</span>/build-tools/27.0.3/zipalign <span class="nt">-v</span> 4 android-release-unsigned.apk vinny.apk
<span class="c"># 使用apksigner工具验证签名有效性</span>
<span class="nv">$ $ANDROID_HOME</span>/build-tools/27.0.3/apksigner verify vinny.apk
</code></pre></div></div><p>完成上述操作后，获取到一个干净的、安全可用的安装包 <strong>vinny.apk</strong>。</p><h3 id="42-ios">4.2 IOS</h3><h4 id="421-名称修改">4.2.1 名称修改</h4><p>编辑 <em>[工程名称]-Info.plist</em> 文件，修改 <strong>Bundle display name</strong> 值，值得注意的是当在终端执行 ionic 的 <code class="highlighter-rouge">build</code> 或者 <code class="highlighter-rouge">run</code> 命令时，此文件会被覆盖，<u>所以当每次发布到 appstore 时都需要进行修改</u>。</p><p><img src="http://ohdpyqlwy.bkt.clouddn.com/ionic-basic-6.png" alt="ionic-basic-6" /></p><h4 id="422-应用市场-">4.2.2 应用市场 ??</h4><h3 id="43-webapp">4.3 Webapp</h3><p>运行下面命令生成用于生产环境可部署的 html 静态文件</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ionic cordova platform add browser
<span class="nv">$ </span>ionic cordova build browser <span class="nt">--prod</span> <span class="nt">--release</span>
</code></pre></div></div><p>将 <em>platforms/browser/www</em> 下的内容拷贝到 HTTP 服务器中即可。</p><h2 id="附录a-cli其他命令">附录A cli其他命令</h2><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ionic docs <span class="c"># 打开在线文档</span>
<span class="nv">$ </span>ionic doctor check <span class="c"># 对工程进行健康检查</span>
<span class="nv">$ </span>ionic doctor list <span class="c"># 列出工程问题列表</span>
</code></pre></div></div><h2 id="附录b-ionic的版本">附录B ionic的版本</h2><p>ionic 至今已发布到 3 的版本，其中 ionic2 与 ionic3 基本一致，ionic1 的版本区别很大，如何识别当前的 ionic 工程是哪个版本，可以查看 <em>ionic.config.json</em> 文件中的 <strong>type</strong> 属性，若是 ionic1 则是1版本构建的，如果是 ionic-angular 则是2或者3版本构建的。</p><p>如何初始化 ionic1 的工程</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>ionic start myapp blank <span class="nt">--type</span><span class="o">=</span>ionic1
<span class="nv">$ </span>ionic start myapp blank <span class="nt">--type</span><span class="o">=</span>ionic-angular <span class="c"># 默认</span>
</code></pre></div></div><div class="divider"></div><blockquote id='by-nc-nd'><div> 版权所有，本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">知识共享署名-非商业性使用 3.0 未本地化版本许可协议</a>进行许可。转载请注明出处：<a href="http://www.vinny.cc//2018/05/ionic-use/" akt="">http://www.vinny.cc//2018/05/ionic-use/</a></div></blockquote><div class="divider"></div></article><div class="page-navigation"> <a class="next" href="/2018/05/pwa-ionic/" title="NEXT: 让 ionic 应用支持 Progressive Web App">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="/" title="Back to Homepage">Home</a> <span> &middot; </span> <a class="prev" href="/2018/05/pwa-sw-precache/" title="PREV: 使用 sw-precache 构建 Progressive Web App">&gt;&gt;</a></div><!-- 书签处理 --> <script type="text/javascript" src="/assets/js/zepto.min.js"></script> <script type="text/javascript" src="/assets/js/nav.js"></script></main><!--<div class="footer"> --> <!--</div>--></body></html>