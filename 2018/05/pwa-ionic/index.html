<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"> <!-- pwa meta begin --><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#000"><meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="msapplication-tap-highlight" content="no"> <!-- IOS不会读取manifest中的icon，用此配置进行适配 --><link rel="apple-touch-icon" href="assets/icons/icon-96x96.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/icon-180x180.png"><link rel="apple-touch-icon" sizes="167x167" href="/assets/icons/icon-167x167.png"> <!-- ios修复splash黑屏 --><link href="/assets/icons/apple_splash_1125.png" sizes="1125x2436" rel="apple-touch-startup-image" /><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"> <!-- pwa meta end --><title>让 ionic 应用支持 Progressive Web App</title><meta name="description" content=""><meta name="keywords" content="pwa,ionic,sw,service-worker"><link rel="icon" href="/assets/favicon.ico"><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/2018/05/pwa-ionic/"><link rel="alternate" type="application/atom+xml" title="Vinny Wong's Blog" href="/feed.xml" /></head><body> <!-- 全局页面loading --><div class="loading"><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div><!-- search --><div class="searchform"> <a href="javascript:void(0);" class="searchicon"></a> <input type="text" id="keyword"/> <a href="javascript:void(0);" class="clear"></a><ul class="suggest"></ul></div><script src="/assets/jquery-1.9.1.min.js"></script> <!-- 图片懒加载 --> <script src="//cdn.jsdelivr.net/npm/lozad"></script> <script src="/assets/main.js"></script><nav class="header-nav"> <a class="page-link" href="/">HOME</a> / <a class="page-link" href="/categories/">CATEGORY</a> / <a class="page-link" href="/feed.xml">FEED</a> / <a class="page-link" href="/about/">ABOUT</a></nav><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article> <!-- 目录导航，在nav,js中进行渲染 --><div class="w-catalog"></div><div class="w-catalog-btn">目录</div><div class="center"><h1>让 ionic 应用支持 Progressive Web App</h1><time>2018-05-12</time></div><div class="divider"></div><ul id="markdown-toc"><li><a href="#删除注释" id="markdown-toc-删除注释">删除注释</a></li><li><a href="#进行部署" id="markdown-toc-进行部署">进行部署</a></li><li><a href="#优化操作" id="markdown-toc-优化操作">优化操作</a><ul><li><a href="#注释-cordova-依赖" id="markdown-toc-注释-cordova-依赖">注释 cordova 依赖</a></li><li><a href="#删除不用的插件" id="markdown-toc-删除不用的插件">删除不用的插件</a></li><li><a href="#完善manifestjson文件" id="markdown-toc-完善manifestjson文件">完善manifest.json文件</a></li><li><a href="#检查服务工作者文件" id="markdown-toc-检查服务工作者文件">检查服务工作者文件</a></li></ul></li></ul><p><strong>ionic</strong> 是当今流行的移动混合式开发解决方案，使用 webview 内核加载页面，具有开发成本低，入手快、丰富的插件库等特点。首先需要明确一点，ionic 默认已经支持了 <strong>PWA</strong>，只需要简单几个步骤就可以开启。</p><p>这里默认你已经有了一个 ionic 的项目了</p><h2 id="删除注释">删除注释</h2><p>首先，进入 <code class="highlighter-rouge">src/index.html</code> 文件中并找到以下注释掉的脚本，该脚本用于注册服务工作者，删除注释。</p><pre><code class="language-Html">&lt;script&gt;
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
      .then(() =&gt; console.log('service worker installed'))
      .catch(err =&gt; console.log('Error', err));
  }
&lt;/script&gt;
</code></pre><p><strong>一个 ionic 的 PWA 应用已经完成</strong>。是的，你没有看错，现在就可以部署它。默认的 ionic 工程已经含有 <em>service-worker.js</em> 文件及 <em>manifest.json</em> 文件，文件中的内容具备”基本”的 PWA 应用的条件，所以只需要删除注释，它就是一个完整的 PWA 应用。</p><h2 id="进行部署">进行部署</h2><p>开始部署，我们需要对代码进行压缩、混淆。幸好，ionic 已经帮我们做了，一切只需要一条命令。</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>npm run ionic:build <span class="nt">--prod</span>
</code></pre></div></div><p>这条命令将对代码以生产模式进行归档，获得发布的最小文件。命令执行完成后，只需要将 <strong>www</strong> 目录上传到指定的 <strong>HTTPS</strong> 服务器中即可。</p><h2 id="优化操作">优化操作</h2><p>为了使用 ionic 应用对 PWA 应用 进行更好的表现，我们还是需要对其缺省的配置进行优化的。</p><h3 id="注释-cordova-依赖">注释 cordova 依赖</h3><p><em>cordova.js</em> 只有运行在 app 环境中才会有用，在 web 环境下只有不停的警告输出，而且还浪费加载时间，所以应该在 <code class="highlighter-rouge">src/index.html</code> 中注释掉。</p><div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- cordova.js required for cordova apps --&gt;</span>
<span class="c">&lt;!--&lt;script src="cordova.js"&gt;&lt;/script&gt;--&gt;</span>
</code></pre></div></div><h3 id="删除不用的插件">删除不用的插件</h3><p>如果只是部署 PWA 应用，可以去 <em>app.component.ts</em> 中删除插件的调用，在 <em>app.module.ts</em> 中删除导入的 <code class="highlighter-rouge">StatusBar</code> 和 <code class="highlighter-rouge">SplashScreen</code> 插件。</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">TabsPage</span> <span class="p">}</span> <span class="k">from</span> <span class="s1">'../pages/tabs/tabs'</span><span class="p">;</span>

<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">templateUrl</span><span class="p">:</span> <span class="s1">'app.html'</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">MyApp</span> <span class="p">{</span>
  <span class="nl">rootPage</span><span class="p">:</span> <span class="nx">any</span> <span class="o">=</span> <span class="nx">TabsPage</span><span class="p">;</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="完善manifestjson文件">完善manifest.json文件</h3><p>缺省的 <em>manifest.json</em> 文件使用的是 ionic 的描述信息，应该讲其修改为自己应用的描述信息，也需要提供多种不同尺寸图标进行配置，更完整的 <em>manifest.json</em> 配置请参看另一篇文章的 <a href="https://vinny.cc/2018/05/pwa-app/#41-%E5%BA%94%E7%94%A8%E6%8F%8F%E8%BF%B0%E6%96%87%E4%BB%B6">应用描述文件</a>。</p><h3 id="检查服务工作者文件">检查服务工作者文件</h3><p>下面是 ionic 缺省的服务工作者 <code class="highlighter-rouge">src/service-worker.js</code> 配置。此配置将预先缓存所有静态资源，确保应用程序在任何网络条件下都可以正常运行，可以根据需要配置 <strong>运行时缓存</strong> 以得到更好的体验。</p><div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">'use strict'</span><span class="p">;</span>

<span class="nx">importScripts</span><span class="p">(</span><span class="s1">'./build/sw-toolbox.js'</span><span class="p">);</span>

<span class="nb">self</span><span class="p">.</span><span class="nx">toolbox</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">cache</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'ionic-cache'</span>
<span class="p">};</span>

<span class="c1">// pre-cache our key assets</span>
<span class="nb">self</span><span class="p">.</span><span class="nx">toolbox</span><span class="p">.</span><span class="nx">precache</span><span class="p">(</span>
  <span class="p">[</span>
    <span class="s1">'./build/main.js'</span><span class="p">,</span>
    <span class="s1">'./build/main.css'</span><span class="p">,</span>
    <span class="s1">'./build/polyfills.js'</span><span class="p">,</span>
    <span class="s1">'index.html'</span><span class="p">,</span>
    <span class="s1">'manifest.json'</span>
  <span class="p">]</span>
<span class="p">);</span>

<span class="c1">// dynamically cache any other local assets</span>
<span class="nb">self</span><span class="p">.</span><span class="nx">toolbox</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="nx">any</span><span class="p">(</span><span class="s1">'/*'</span><span class="p">,</span> <span class="nb">self</span><span class="p">.</span><span class="nx">toolbox</span><span class="p">.</span><span class="nx">cacheFirst</span><span class="p">);</span>

<span class="c1">// for any other requests go to the network, cache,</span>
<span class="c1">// and then only use that cached resource if your user goes offline</span>
<span class="nb">self</span><span class="p">.</span><span class="nx">toolbox</span><span class="p">.</span><span class="nx">router</span><span class="p">.</span><span class="k">default</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="nx">toolbox</span><span class="p">.</span><span class="nx">networkFirst</span><span class="p">;</span>
</code></pre></div></div><div class="divider"></div><blockquote id='by-nc-nd'><div> 版权所有，本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">知识共享署名-非商业性使用 3.0 未本地化版本许可协议</a>进行许可。转载请注明出处：<a href="http://www.vinny.cc//2018/05/pwa-ionic/" akt="">http://www.vinny.cc//2018/05/pwa-ionic/</a></div></blockquote><div class="divider"></div></article><div class="page-navigation"> <a class="next" href="/2018/05/ionic-bootstrap/" title="NEXT: 在 ionic 中集成 bootstrap 框架">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="/" title="Back to Homepage">Home</a> <span> &middot; </span> <a class="prev" href="/2018/05/pwa-sw-precache/" title="PREV: 使用 sw-precache 构建 Progressive Web App">&gt;&gt;</a></div><!-- 书签处理 --> <script type="text/javascript" src="/assets/js/zepto.min.js"></script> <script type="text/javascript" src="/assets/js/nav.js"></script></main><!--<div class="footer"> --> <!--</div>--></body></html>