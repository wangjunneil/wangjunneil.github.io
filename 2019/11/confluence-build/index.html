<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"> <!-- pwa meta begin --><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#000"><meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="format-detection" content="telephone=no"><meta name="msapplication-tap-highlight" content="no"> <!-- IOS不会读取manifest中的icon，用此配置进行适配 --><link rel="apple-touch-icon" href="assets/icons/icon-96x96.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/icon-180x180.png"><link rel="apple-touch-icon" sizes="167x167" href="/assets/icons/icon-167x167.png"> <!-- ios修复splash黑屏 --><link href="/assets/img/icons/apple_splash_1125.png" sizes="1125x2436" rel="apple-touch-startup-image" /><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"> <!-- pwa meta end --><title>私有知识库 confluence 以 docker 为容器的安装</title><meta name="description" content=""><meta name="keywords" content="wiki,confluence"><link href="https://fonts.googleapis.com/css?family=Anonymous+Pro&display=swap" rel="stylesheet"><link rel="icon" href="/assets/favicon.ico"><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/2019/11/confluence-build/"><link rel="alternate" type="application/atom+xml" title="The Jun Wong's blog" href="/feed.xml" /></head><body> <!-- 全局页面loading --><div class="loading"><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div><!-- search --><div class="searchform"> <a href="javascript:void(0);" class="searchicon"></a> <input type="text" id="keyword" autocomplete="off"/> <a href="javascript:void(0);" class="clear"></a><ul class="suggest"></ul></div><script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script> <script src="/assets/js/main.js"></script><nav class="header-nav"> <a class="page-link" href="/">HOME</a> / <a class="page-link" href="/categories/">CATEGORY</a> / <a class="page-link" href="/feed.xml">FEED</a> <!-- <a class="page-link" href="/lab/index.html">MYLAB</a> --> / <a class="page-link" href="/about/">ABOUT</a></nav><main><article> <!-- 目录导航，在nav,js中进行渲染 --><div class="w-catalog"></div><div class="w-catalog-btn">目录</div><div class="center"><h1>私有知识库 confluence 以 docker 为容器的安装</h1><time>2019-11-20</time></div><div class="divider"></div><ul id="markdown-toc"><li><a href="#1-背景介绍" id="markdown-toc-1-背景介绍">1. 背景介绍</a></li><li><a href="#2-安装步骤" id="markdown-toc-2-安装步骤">2. 安装步骤</a><ul><li><a href="#21-postgresql镜像拉取与启动" id="markdown-toc-21-postgresql镜像拉取与启动">2.1 Postgresql镜像拉取与启动</a></li><li><a href="#22-为confluence准备数据库" id="markdown-toc-22-为confluence准备数据库">2.2 为confluence准备数据库</a></li><li><a href="#23-confluence镜像拉取与启动" id="markdown-toc-23-confluence镜像拉取与启动">2.3 Confluence镜像拉取与启动</a></li></ul></li><li><a href="#3-界面配置" id="markdown-toc-3-界面配置">3. 界面配置</a></li><li><a href="#4-破解步骤" id="markdown-toc-4-破解步骤">4. 破解步骤</a><ul><li><a href="#41-获取破解文件" id="markdown-toc-41-获取破解文件">4.1 获取破解文件</a></li><li><a href="#42-运行破解程序" id="markdown-toc-42-运行破解程序">4.2 运行破解程序</a></li><li><a href="#43-上传破解补丁" id="markdown-toc-43-上传破解补丁">4.3 上传破解补丁</a></li><li><a href="#44-重启confluence容器" id="markdown-toc-44-重启confluence容器">4.4 重启confluence容器</a></li></ul></li><li><a href="#5-继续配置" id="markdown-toc-5-继续配置">5. 继续配置</a></li><li><a href="#附录安装遇到的问题" id="markdown-toc-附录安装遇到的问题">附录：安装遇到的问题</a></li></ul><h2 id="1-背景介绍">1. 背景介绍</h2><p>没有特殊原因，只想什么都用自己的，数据保存在自己这，做好维护，永不丢失，<strong>代代传承</strong>。几乎用遍所有笔记、wiki、博客， 始终在不断迁移，不停在寻找一个真正合适自己的记录的地方，最终还是决定使用 <a href="//www.atlassian.com/software/confluence">confluence</a>，尽管相对于个人过于庞大、复杂， 但经过研究后发现可以满足所有需求，本文将介绍如何使用 docker 安装部署一套属于自己的知识库管理系统。</p><blockquote><p>这里需要说明一下，为什么使用docker方式，简单、高效、隔离性好，已具备基本环境，所以选择</p></blockquote><h2 id="2-安装步骤">2. 安装步骤</h2><p>提前安装好 docker 环境，不同系统安装步骤网上搜索，以下步骤是已经安装好的情况下进行</p><h3 id="21-postgresql镜像拉取与启动">2.1 Postgresql镜像拉取与启动</h3><p>这里使用的是 postgresql 数据库做为数据存储，也可以使用其他，如mariadb等等，麻烦的是需要自行下载驱动文件并上传到confluence目录中，所以这里使用 postgresql</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 拉取</span>
<span class="nv">$ </span>docker pull postgres:latest

<span class="c"># 运行</span>
<span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="se">\</span>
  <span class="nt">--name</span> postgresdb <span class="se">\</span>
  <span class="nt">-p</span> 5432:5432 <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>123456 <span class="se">\</span>
  postgres
</code></pre></div></div><h3 id="22-为confluence准备数据库">2.2 为confluence准备数据库</h3><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 进入 postgresql 容器</span>
<span class="nv">$ </span>docker <span class="nb">exec</span> <span class="nt">-it</span> postgresdb /bin/bash
<span class="c"># 登录 postgresql 数据库系统</span>
<span class="nv">$ </span>psql <span class="nt">-U</span> postgres
<span class="c"># 创建一个空的 confluence 数据库</span>
<span class="nv">$ </span>CREATE DATABASE confluence WITH OWNER postgres<span class="p">;</span>
<span class="c"># 退出数据库</span>
<span class="nv">$ </span><span class="se">\q</span>
<span class="c"># 退出容器</span>
<span class="nv">$ </span><span class="nb">exit</span>
</code></pre></div></div><h3 id="23-confluence镜像拉取与启动">2.3 Confluence镜像拉取与启动</h3><p>docker 仓库中有很多 confluence 的镜像，不同镜像之间可能因为版本不同，建议使用如下的镜像以保证后续步骤的正常</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 拉取</span>
<span class="nv">$ </span>docker pull cptactionhank/atlassian-confluence:latest

<span class="c"># 运行</span>
<span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="se">\</span>
  <span class="nt">--name</span> confluence <span class="se">\</span>
  <span class="nt">-p</span> 58093:8090 <span class="se">\</span>
  <span class="nt">--link</span> postgresdb:db <span class="se">\</span>
  <span class="nt">--user</span> root:root <span class="se">\</span>
  cptactionhank/atlassian-confluence:latest
</code></pre></div></div><blockquote><p>confluence配置了<strong>58093</strong>做为外部映射端口，并连接上面已经启动好的postgresql容器，别名用db，且以root的方式运行</p></blockquote><h2 id="3-界面配置">3. 界面配置</h2><p>上述操作完成后，通过浏览器打开 http://192.168.1.100:58093，注意这里的 192.168.1.100 是 docker 容器地址，如果是本地则使用 127.0.0.1， 端口58093是启动 confluence 容器时指定的对外接口，打开后在语言栏切换成中文后，点击下一步</p><p><img src="//via.placeholder.com/594x485?text=&quot;&quot;" alt="confluence-1" data-src="//vinnycc.oss-cn-shanghai.aliyuncs.com/20191120/confluence-1.webp" /></p><p>这两个应用对于个人来说用不上，占硬盘和内存，不选择直接点击下一步</p><p><img src="//via.placeholder.com/594x485?text=&quot;&quot;" alt="confluence-2" data-src="//vinnycc.oss-cn-shanghai.aliyuncs.com/20191120/confluence-2.webp" /></p><p>复制<strong>服务器ID</strong>到记事本上，后续需要使用，不需要点击下一步，<strong>直接关闭浏览器开始破解操作</strong></p><p><img src="//via.placeholder.com/594x485?text=&quot;&quot;" alt="confluence-3" data-src="//vinnycc.oss-cn-shanghai.aliyuncs.com/20191120/confluence-3.webp" /></p><h2 id="4-破解步骤">4. 破解步骤</h2><h3 id="41-获取破解文件">4.1 获取破解文件</h3><p>从 confluence 容器中将 <em>atlassian-extras-decoder-v2-3.4.1.jar</em> 文件拷贝出来并改名为 <em>atlassian-extras-2.4.jar</em></p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 从容器拷贝出来</span>
<span class="nv">$ </span>docker <span class="nb">cp </span>confluence:/opt/atlassian/confluence/confluence/WEB-INF/lib/atlassian-extras-decoder-v2-3.4.1.jar ./
<span class="c"># 重命名</span>
<span class="nv">$ </span><span class="nb">mv </span>atlassian-extras-decoder-v2-3.4.1.jar atlassian-extras-2.4.jar
</code></pre></div></div><h3 id="42-运行破解程序">4.2 运行破解程序</h3><p>先下载破解文件，<a href="//cigorsica.com/1oBj" target="_blank">点击下载</a>，使用命令<code class="highlighter-rouge">java -jar confluence_keygen.jar</code>运行，这里需要java运行环境， 输入刚才记录的<strong>服务器ID</strong>，点击<strong>.patch!</strong>按钮，选择之前改名的 <em>atlassian-extras-2.4.jar</em> 文件，提示”Jar successfully patched”表示 补丁打成功。</p><p><img src="//via.placeholder.com/594x485?text=&quot;&quot;" alt="confluence-4" data-src="//vinnycc.oss-cn-shanghai.aliyuncs.com/20191120/confluence-4.webp" /></p><p>再点击<strong>.gen!</strong>按钮生成密钥信息并拷贝记录起来，后面要使用</p><p><img src="//via.placeholder.com/594x485?text=&quot;&quot;" alt="confluence-5" data-src="//vinnycc.oss-cn-shanghai.aliyuncs.com/20191120/confluence-5.webp" /></p><h3 id="43-上传破解补丁">4.3 上传破解补丁</h3><p>将打好破解补丁的文件 <em>atlassian-extras-2.4.jar</em> 重新改名为 <em>atlassian-extras-decoder-v2-3.4.1.jar</em> 并上传覆盖到 confluence 容器原有的位置中</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 重新命名</span>
<span class="nv">$ </span><span class="nb">mv </span>atlassian-extras-2.4.jar atlassian-extras-decoder-v2-3.4.1.jar
<span class="c"># 上传覆盖</span>
<span class="nv">$ </span>docker <span class="nb">cp </span>atlassian-extras-decoder-v2-3.4.1.jar confluence:/opt/atlassian/confluence/confluence/WEB-INF/lib/
</code></pre></div></div><h3 id="44-重启confluence容器">4.4 重启confluence容器</h3><p>重新启动 confluence 容器，以让 confluence 重新加载已经破解的补丁文件，否则内存中使用的还是未破解的</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 重启容器</span>
<span class="nv">$ </span>docker restart confluence
</code></pre></div></div><h2 id="5-继续配置">5. 继续配置</h2><p>confluence 容器重启好后重新打开界面控制台将会直接跳到输入密钥内容的界面，粘贴上面拷贝的密钥内容后点击下一步开始设置数据库</p><p><img src="//via.placeholder.com/594x485?text=&quot;&quot;" alt="confluence-6" data-src="//vinnycc.oss-cn-shanghai.aliyuncs.com/20191120/confluence-6.webp" /></p><p><img src="//via.placeholder.com/594x485?text=&quot;&quot;" alt="confluence-7" data-src="//vinnycc.oss-cn-shanghai.aliyuncs.com/20191120/confluence-7.webp" /></p><p><img src="//via.placeholder.com/594x485?text=&quot;&quot;" alt="confluence-8" data-src="//vinnycc.oss-cn-shanghai.aliyuncs.com/20191120/confluence-8.webp" /></p><p>设置使用通过连接字符串连接数据库，内容填写”jdbc:postgresql://db:5432/confluence”，输入用户名密码，点击测试连接，成功后点击下一步，开始 刷入 confluence 表结构，稍等一会就会出现以下界面表示安装成功</p><p>首次使用的话推荐选择”示范站点”，包含了许多demo的文章供编写参考，有洁癖的话使用”空白站点”，这样更纯净些</p><p><img src="//via.placeholder.com/594x485?text=&quot;&quot;" alt="confluence-9" data-src="//vinnycc.oss-cn-shanghai.aliyuncs.com/20191120/confluence-9.webp" /></p><p>配置Confluence中的管理用户和组，就是管理员用户名和密码等信息，完成后显示设置成功</p><h2 id="附录安装遇到的问题">附录：安装遇到的问题</h2><p>在设置数据库连接后点击下一步时可能会超时，超时后重新刷新界面出现”Spring Application context has not been set”的错误， 不要怀疑，直接到 confluence 容器中删除文件 confluence.cfg.xml 后，重新启动，将会再次进入第一步的配置界面，密钥可以使用 之前保存的，继续步骤就可以成功</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 删除 confluence.cfg.xml 文件</span>
<span class="nv">$ </span>docker <span class="nb">exec </span>confluence <span class="nb">rm</span> <span class="nt">-rf</span> /var/atlassian/confluence/confluence.cfg.xml
<span class="c"># 重启 confluence 容器</span>
<span class="nv">$ </span>docker restart confluence
</code></pre></div></div><div class="divider"></div><blockquote id='by-nc-nd'><div> 版权所有，本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">知识共享署名-非商业性使用 3.0 未本地化版本许可协议</a>进行许可。转载请注明出处：<a href="http://localhost:4000//2019/11/confluence-build/" akt="">http://localhost:4000//2019/11/confluence-build/</a></div></blockquote><div class="divider"></div></article><div class="page-navigation"> <a class="next" href="/2019/11/nmap-general/" title="NEXT: Nmap 常规使用方法">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="/" title="Back to Homepage">Home</a> <span> &middot; </span> <a class="prev" href="/2019/06/wireguard-build/" title="PREV: 旅行必备 Wireguard 的搭建与使用">&gt;&gt;</a></div><!-- 书签处理 --> <script type="text/javascript" src="/assets/js/zepto.min.js"></script> <script type="text/javascript" src="/assets/js/nav.js"></script></main><!-- service worker check update bar --><div id="notification">A new version of this app is available. Click <a id="reload">here</a> to update.</div></body></html>