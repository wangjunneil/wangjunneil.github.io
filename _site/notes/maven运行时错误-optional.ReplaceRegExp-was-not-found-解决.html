<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Maven运行时错误"optional.replaceregexp was not found"解决</title><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@HeiswayiNrird" /><meta name="twitter:title" content="Maven运行时错误"optional.replaceregexp was not found"解决" /><meta name="twitter:description" content="使用 maven 构建时有时并不能满足工程的需要，因为maven的约束性，较细节的构建处理还需要和 ant 搭配才能完成。当执行 ant 中的核心任务时，如 copy、delete 等等，并不会出现任何问题，当执行一些高级任务时，如 ftp、ssh 或者 replaceregexp 等任务时就会出现问题。"><meta name="description" content="使用 maven 构建时有时并不能满足工程的需要，因为maven的约束性，较细节的构建处理还需要和 ant 搭配才能完成。当执行 ant 中的核心任务时，如 copy、delete 等等，并不会出现任何问题，当执行一些高级任务时，如 ftp、ssh 或者 replaceregexp 等任务时就会出现问题。"><meta name="google-site-verification" content="epFgX0s_0RM3CdjwFcsewfXzPov2g8s9ZBOLyaIUH-o"><link rel="icon" href="/assets/favicon.ico"><link rel="apple-touch-icon" href="/assets/touch-icon.png"><link href="https://fonts.googleapis.com/css?family=Karla" rel="stylesheet"><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/notes/maven%E8%BF%90%E8%A1%8C%E6%97%B6%E9%94%99%E8%AF%AF-optional.ReplaceRegExp-was-not-found-%E8%A7%A3%E5%86%B3"><link rel="alternate" type="application/atom+xml" title="A Coder, a Programmer, a Hacker walk into Evan's Blog" href="/feed.xml" /></head><body><aside class="logo"> <a href="/"> <img src="/assets/evan.jpeg" class="gravatar"> </a> <span class="logo-prompt">Back to Home</span></aside><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>Maven运行时错误"optional.replaceregexp was not found"解决</h1><time>September 10, 2016</time></div><div class="divider"></div><p>使用 <code class="highlighter-rouge">maven</code> 构建时有时并不能满足工程的需要，因为maven的约束性，较细节的构建处理还需要和 <code class="highlighter-rouge">ant</code> 搭配才能完成。当执行 <strong>ant</strong> 中的核心任务时，如 <strong>copy</strong>、<strong>delete</strong> 等等，并不会出现任何问题，当执行一些高级任务时，如 <strong>ftp</strong>、<strong>ssh</strong> 或者 <strong>replaceregexp</strong> 等任务时就会出现问题。</p><p>比如在构建项目时，我们需要将文本文件（启动脚本、配置文件）进行回车换行处理，解决在 <strong>unix</strong> 上执行出现 <strong>\^M</strong> 的问题，这里需要使用 <strong>replaceregexp</strong> 的任务进行字符的替换。</p><h1 id="下面是报错时的-pom-配置">下面是报错时的 pom 配置</h1><div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>maven-antrun-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;executions&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;goals&gt;&lt;goal&gt;</span>run<span class="nt">&lt;/goal&gt;&lt;/goals&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
                <span class="nt">&lt;tasks&gt;</span>
                    <span class="nt">&lt;replaceregexp</span>  <span class="na">match=</span><span class="s">"&amp;#13;&amp;#10;"</span> <span class="na">replace=</span><span class="s">"&amp;#10;"</span> <span class="na">flags=</span><span class="s">"g"</span> <span class="na">byline=</span><span class="s">"false"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;fileset</span> <span class="na">dir=</span><span class="s">"${project.basedir}/target/${project.build.finalName}"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">"bin/*.sh"</span> <span class="nt">/&gt;</span>
                            <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">"conf/*.properties"</span> <span class="nt">/&gt;</span>
                            <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">"server/WEB-INF/class/*.xml"</span> <span class="nt">/&gt;</span>
                        <span class="nt">&lt;/fileset&gt;</span>
                   <span class="nt">&lt;/replaceregexp&gt;</span>
               <span class="nt">&lt;/tasks&gt;</span>
           <span class="nt">&lt;/configuration&gt;</span>
       <span class="nt">&lt;/execution&gt;</span>
       <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div><p>执行构建任务时出错的信息如下：</p><div class="highlighter-rouge"><pre class="highlight"><code>[ERROR] Cause: the class org.apache.tools.ant.taskdefs.optional.ReplaceRegExp was not found.
[ERROR] This looks like one of Ant's optional components.
[ERROR] Action: Check that the appropriate optional JAR exists in
[ERROR] -ANT_HOME/lib
[ERROR] -the IDE Ant configuration dialogs
[ERROR] 
[ERROR] Do not panic, this is a common problem.
[ERROR] The commonest cause is a missing JAR.
</code></pre></div><h1 id="出现此问题的原因是什么">出现此问题的原因是什么</h1><p>若在终端上直接执行 <code class="highlighter-rouge">ant</code> 时并不会有错，使用 <code class="highlighter-rouge">maven</code> 执行时就会出现错误，这是因为使用ant执行时，所有核心和可选的任务都在ant的安装包里，当执行maven时，maven将会使用自身的ant库，而maven里的ant库只有核心任务，并没有可选的任务库文件。知道问题所在，解决就有针对性了，要么告诉maven在执行时需要使用本地的ant环境，要么在添加ant的可选依赖，下面时修改后的maven配置。</p><div class="language-xml highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>maven-antrun-plugin<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;executions&gt;</span>
        <span class="nt">&lt;execution&gt;</span>
            <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
            <span class="nt">&lt;goals&gt;&lt;goal&gt;</span>run<span class="nt">&lt;/goal&gt;&lt;/goals&gt;</span>
            <span class="nt">&lt;configuration&gt;</span>
                <span class="nt">&lt;tasks&gt;</span>
                    <span class="nt">&lt;replaceregexp</span>  <span class="na">match=</span><span class="s">"&amp;#13;&amp;#10;"</span> <span class="na">replace=</span><span class="s">"&amp;#10;"</span> <span class="na">flags=</span><span class="s">"g"</span> <span class="na">byline=</span><span class="s">"false"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;fileset</span> <span class="na">dir=</span><span class="s">"${project.basedir}/target/${project.build.finalName}"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">"bin/*.sh"</span> <span class="nt">/&gt;</span>
                            <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">"conf/*.properties"</span> <span class="nt">/&gt;</span>
                            <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">"server/WEB-INF/class/*.xml"</span> <span class="nt">/&gt;</span>
                        <span class="nt">&lt;/fileset&gt;</span>
                   <span class="nt">&lt;/replaceregexp&gt;</span>
               <span class="nt">&lt;/tasks&gt;</span>
           <span class="nt">&lt;/configuration&gt;</span>
       <span class="nt">&lt;/execution&gt;</span>
    <span class="nt">&lt;/executions&gt;</span>
    <span class="c">&lt;!-- 添加ant可选任务的依赖文件 --&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>ant<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>ant-nodeps<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.6.5<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>ant<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>ant-apache-regexp<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.6.5<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jakarta-regexp<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>jakarta-regexp<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.4<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div></article><div class="page-navigation"> <a class="next" href="/notes/%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84iptables%E9%98%B2%E7%81%AB%E5%A2%99%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E6%89%8D%E8%83%BD%E6%9B%B4%E5%AE%89%E5%85%A8" title="NEXT: 服务器上的iptables防火墙应该如何配置才能更安全">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="/" title="Back to Homepage">首页</a> <span> &middot; </span> <a class="prev" href="/notes/jdk1.8%E4%B8%AD%E6%B5%81stream%E7%9A%84%E5%A4%84%E7%90%86-%E9%81%8D%E5%8E%86-%E8%81%9A%E5%90%88%E7%AD%89%E7%A4%BA%E4%BE%8B%E6%93%8D%E4%BD%9C" title="PREV: Jdk1.8中流stream的处理、遍历、聚合等示例操作">&gt;&gt;</a></div></main><div class="footer"> <!-- <span class="block">Made with &hearts; using <a href="http://jekyllrb.com/">Jekyll</a> &amp; <a href="https://github.com/heiswayi/the-plain" title="The Plain theme by Heiswayi Nrird">The Plain</a> &middot; &lt;/&gt; on <a href="https://github.com/wangjunneil" title="Hosted on GitHub">GitHub</a></span> --> <span class="block"><a href="https://wangjunneil.github.io">Evan's Blog</a> © 2016 - All Rights Reserved</span></div></body></html>