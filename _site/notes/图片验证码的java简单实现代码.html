<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>图片验证码的java简单实现代码</title><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@HeiswayiNrird" /><meta name="twitter:title" content="图片验证码的java简单实现代码" /><meta name="twitter:description" content=""><meta name="description" content=""><meta name="google-site-verification" content="epFgX0s_0RM3CdjwFcsewfXzPov2g8s9ZBOLyaIUH-o"><link rel="icon" href="/assets/favicon.ico"><link rel="apple-touch-icon" href="/assets/touch-icon.png"><link href="https://fonts.googleapis.com/css?family=Karla" rel="stylesheet"><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/notes/%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81%E7%9A%84java%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81"><link rel="alternate" type="application/atom+xml" title="A Coder, a Programmer, a Hacker walk into Evan's Blog" href="/feed.xml" /></head><body><aside class="logo"> <a href="/"> <img src="/assets/evan.jpeg" class="gravatar"> </a> <span class="logo-prompt">Back to Home</span></aside><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>图片验证码的java简单实现代码</h1><time>July 31, 2016</time></div><div class="divider"></div><p><img src="../images/image_code.png" alt="图片验证码的java简单实现代码" /></p><p>图片验证码主要的功能是为了阻止循环请求避免暴力破解的手段之一，当然还有很多类型的验证请求，如google验证码、12306变态选图片或者拖动式。上述截图是一种基本的4位数字字母组合图片验证码方式，包含了横线竖线、字体旋转的干扰方式。实现方式很简单，这里只用一个servlet实现，直接贴代码，如下：</p><div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">wangjunneil</span><span class="o">.</span><span class="na">servlet</span><span class="o">;</span>
 
<span class="kn">import</span> <span class="nn">javax.imageio.ImageIO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.image.BufferedImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
 
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ImgCodeServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
     
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="c1">// 定义图片验证码的宽度和高度</span>
        <span class="kt">int</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">120</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">40</span><span class="o">;</span>
        <span class="c1">// 设置干扰线条数</span>
        <span class="kt">int</span> <span class="n">lineCount</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
 
        <span class="c1">// 创建图片缓冲区对象</span>
        <span class="n">BufferedImage</span> <span class="n">image</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedImage</span><span class="o">(</span><span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">,</span> <span class="n">BufferedImage</span><span class="o">.</span><span class="na">TYPE_INT_RGB</span><span class="o">);</span>
        <span class="n">Graphics2D</span> <span class="n">g</span> <span class="o">=</span> <span class="o">(</span><span class="n">Graphics2D</span><span class="o">)</span> <span class="n">image</span><span class="o">.</span><span class="na">getGraphics</span><span class="o">();</span>
 
        <span class="c1">// 设置背景色为白色</span>
        <span class="n">g</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">white</span><span class="o">);</span>
        <span class="n">g</span><span class="o">.</span><span class="na">fillRect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">);</span>
 
        <span class="c1">// 设置验证码图片边框颜色</span>
        <span class="n">g</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">RED</span><span class="o">);</span>
        <span class="n">g</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
 
        <span class="c1">// 图片写入内容定义</span>
        <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="s">"1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="o">;</span>
        <span class="n">Random</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">14</span><span class="o">;</span> <span class="c1">// 定义第一个字符的x坐标</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="c1">// 获取随机内容字符</span>
            <span class="kt">char</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">()));</span>
 
            <span class="c1">// 设置字体样式</span>
            <span class="n">g</span><span class="o">.</span><span class="na">setFont</span><span class="o">(</span><span class="k">new</span> <span class="n">Font</span><span class="o">(</span><span class="s">"宋体"</span><span class="o">,</span> <span class="n">Font</span><span class="o">.</span><span class="na">BOLD</span><span class="o">,</span> <span class="mi">28</span><span class="o">));</span>
            <span class="n">g</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">255</span><span class="o">),</span> <span class="n">r</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">255</span><span class="o">),</span> <span class="n">r</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">255</span><span class="o">)));</span>
 
            <span class="c1">// 设置字符旋转</span>
            <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">90</span><span class="o">);</span>
            <span class="kt">double</span> <span class="n">rad</span> <span class="o">=</span> <span class="o">(</span><span class="mi">90</span> <span class="o">-</span> <span class="mi">60</span><span class="o">)</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="na">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="o">;</span>
            <span class="n">g</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="n">rad</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="mi">25</span><span class="o">);</span>
 
            <span class="c1">// 内容字符写到缓冲区</span>
            <span class="n">g</span><span class="o">.</span><span class="na">drawString</span><span class="o">(</span><span class="n">Character</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">ch</span><span class="o">),</span> <span class="n">x</span><span class="o">,</span> <span class="mi">25</span><span class="o">);</span>
 
            <span class="c1">// 旋转复原</span>
            <span class="n">g</span><span class="o">.</span><span class="na">rotate</span><span class="o">(-</span><span class="n">rad</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="mi">25</span><span class="o">);</span>
 
            <span class="c1">// 下一个字符x坐标</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">25</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="c1">// 设置干扰线</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">lineCount</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">g</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">255</span><span class="o">),</span> <span class="n">r</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">255</span><span class="o">),</span> <span class="n">r</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">255</span><span class="o">)));</span>
            <span class="n">g</span><span class="o">.</span><span class="na">drawLine</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">width</span><span class="o">),</span> <span class="n">r</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">height</span><span class="o">),</span> <span class="n">r</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">width</span><span class="o">),</span> <span class="n">r</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">height</span><span class="o">));</span>
        <span class="o">}</span>
 
        <span class="c1">// 输出到浏览器中</span>
        <span class="n">ImageIO</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">image</span><span class="o">,</span> <span class="s">"png"</span><span class="o">,</span> <span class="n">resp</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><p>注意这里只是测试图片验证码的显示，并没有把生成的字符组合放入session中，实际生产时应该放入session，在处理登陆请求时取出进行验证。</p></article><div class="page-navigation"> <a class="next" href="/notes/%E6%B2%A1%E6%9C%89visualstdio%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%BC%96%E8%AF%91%E5%BC%80%E5%8F%91windows%E5%BA%94%E7%94%A8" title="NEXT: 没有visualstdio使用命令行编译开发windows应用">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="/" title="Back to Homepage">首页</a> <span> &middot; </span> <a class="prev" href="/notes/%E5%AE%9E%E7%8E%B0Google%E4%BA%BA%E6%9C%BA%E4%BA%A4%E4%BA%92%E9%AA%8C%E8%AF%81%E7%9A%84%E6%8E%A5%E5%85%A5%E6%96%B9%E5%BC%8F" title="PREV: 实现google人机交互验证的接入方式">&gt;&gt;</a></div></main><div class="footer"> <!-- <span class="block">Made with &hearts; using <a href="http://jekyllrb.com/">Jekyll</a> &amp; <a href="https://github.com/heiswayi/the-plain" title="The Plain theme by Heiswayi Nrird">The Plain</a> &middot; &lt;/&gt; on <a href="https://github.com/wangjunneil" title="Hosted on GitHub">GitHub</a></span> --> <span class="block"><a href="https://wangjunneil.github.io">Evan's Blog</a> © 2016 - All Rights Reserved</span></div></body></html>